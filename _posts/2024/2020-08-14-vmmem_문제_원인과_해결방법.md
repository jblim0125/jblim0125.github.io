---
layout: post
title: WSL vmmem 문제 원인과 해결방법
author: jblim0125
date: 2020-08-14
category: 2020
---

## WSL2 기반 docker 사용시 vmmem 프로세스 메모리 소모량 줄이기  

1. PC 속도 저하  
PC 속도 저하가 발생하였을 때, 프로세스 상태를 확인하면 vmmem 프로세스가 등장한다.  
wsl2 - docker의 문제이다. wsl2 환경에서 docker system prune 등의 커맨드로는 해결되지 않는다.

2. MS 측은 이 문제를 파악하고 있는가?  
WSL2 github에는 이 램 소모에 대한 이슈도 등장했고 해결이 어려운지 계속 open 상태이다.
https://github.com/microsoft/WSL/issues/4166

3. 문제의 원인은 무엇인가?  
리눅스에서 파일 액세스할 때, 리눅스 OS는 그 정보를 캐시로 사용하기 위해 메모리에 보존한다.
이는 메모리가 부족해 더 이상 보존할 수 없을 때까지 반복된다.
WSL2는 Linux의 메모리 사용량에 따라 사용 메모리 크기를 동적으로 증가/감소시킨다.  
```
리눅스에서 파일 액세스의 정보를 WSL2에서 배당받은 메모리에 보존한다.
이는 파일 열람을 할 때마다 매번 발생한다.
⬇
리눅스의 배당받은 메모리가 한계에 달한다.
⬇
WSL2가 메모리를 추가 할당한다.
⬇
리눅스가 배당받은 메모리가 한계에 달한다.
⬇
무한 악순환
```
웹에서 조사한 내용이니 다소 다를 수도 있지만, 대강 이런 문제인듯하다. 이는 최대 PC 메모리 사용량의 
80%까지(16g 메모리는 12.8G) 악순환이 반복된다 하니 무시 못할 문제이다. MS 측이 쉽게 해결하지 못하는 
것을 보니, 고질적이고 근본적인 이슈로 보인다. 경위야 어찌 됐든 우리는 우리의 메모리를 아껴줄 필요가 
있다. 그러지 않으면 도커 컨테이너를 사용하면서 코딩을 하면 메모리 사용량이 천정부지 치솟는 지옥도를 
몸소 체감할 수 있을 것이다. (+ 발열)


## WSL2 재시작 방법
1. Start PowerShell(Admin)  
2. Run Next Command
```
Get-Service LxssManager | Restart-Service
```
